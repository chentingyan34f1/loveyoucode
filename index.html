<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª≠i ng∆∞·ªùi th∆∞∆°ng</title>
    <style>
        /* --- CSS STYLE --- */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        
        /* Container ·∫£nh bay */
        #image-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        .floating-image { position: absolute; width: 80px; height: auto; border-radius: 10px; box-shadow: 0 0 15px rgba(255, 105, 180, 0.8); opacity: 0; animation: floatUp 15s linear infinite; object-fit: cover;}
        @keyframes floatUp { 0% { transform: translateY(110vh) scale(0.5) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-10vh) scale(1) rotate(20deg); opacity: 0; } }
        
        /* UI Form Nh·∫≠p li·ªáu */
        #ui-layer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; background: rgba(20, 20, 20, 0.95); padding: 30px; border-radius: 20px; width: 400px; box-shadow: 0 0 30px rgba(255, 105, 180, 0.4); border: 1px solid #333; color: white; display: flex; flex-direction: column; gap: 15px; }
        #ui-layer.hidden { display: none; }
        h2 { color: #ff69b4; margin: 0; text-align: center; }
        label { font-size: 12px; color: #aaa; margin-bottom: -10px; }
        
        textarea { padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 8px; resize: none; height: 80px; font-family: inherit; }
        input { padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 8px; }
        input:focus, textarea:focus { outline: 2px solid #ff69b4; border-color: transparent; }
        
        button { padding: 12px; background: linear-gradient(45deg, #ff69b4, #ff1493); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: transform 0.2s; }
        button:hover { transform: scale(1.02); }
        .secondary-btn { background: #444; }

        /* N√∫t m·ªü l·∫°i c√†i ƒë·∫∑t */
        #settings-btn { position: absolute; top: 10px; right: 10px; z-index: 101; background: transparent; color: rgba(255,255,255,0.3); border: none; font-size: 24px; cursor: pointer; }
        #settings-btn:hover { color: white; }

        /* Ch·ªØ k√Ω */
        #signature { position: absolute; bottom: 20px; width: 100%; text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 14px; z-index: 5; font-style: italic; pointer-events: none;}
    </style>
</head>
<body>
    <canvas id="heartCanvas"></canvas>
    <div id="image-container"></div>
    <div id="signature"></div>
    <audio id="bg-music" loop></audio>

    <button id="settings-btn" onclick="toggleUI()">‚öôÔ∏è</button>

    <div id="ui-layer">
        <h2>üíñ Thi·∫øt k·∫ø L·ªùi Nh·∫Øn üíñ</h2>
        
        <label>L·ªùi nh·∫Øn (M·ªói d√≤ng l√† m·ªôt c√¢u, s·∫Ω hi·ªán l·∫ßn l∆∞·ª£t):</label>
        <textarea id="MessagesInput" placeholder="Ch√†o em/nAnh nh·ªõ em l·∫Øm/nL√†m ng∆∞·ªùi y√™u anh nh√©?">Ch√†o c·∫≠u,
T·ªõ c√≥ ƒëi·ªÅu mu·ªën n√≥i...
L√†m ng∆∞·ªùi y√™u t·ªõ nh√©?
M√£i y√™u <3</textarea>
        
        <label>T√™n c·ªßa b·∫°n (K√Ω t√™n):</label>
        <input type="text" id="SignatureInput" placeholder="V√≠ d·ª•: T·ª´ Tu·∫•n Anh" value="">

        <label>Link nh·∫°c MP3 (T√πy ch·ªçn):</label>
        <input type="text" id="MusicInput" placeholder="D√°n link mp3 v√†o ƒë√¢y..." value="https://data.chiasenhac.com/down2/2276/4/2275328-9a997381/128/I%20Do%20-%20911.mp3">

        <label>Link ·∫£nh (C√°ch nhau d·∫•u ph·∫©y):</label>
        <input type="text" id="ImagesInput" value="https://cdn-icons-png.flaticon.com/512/2190/2190552.png" placeholder="Link ·∫£nh 1, Link ·∫£nh 2...">

        <button onclick="startEffect()">üíò B·∫Øt ƒë·∫ßu ch·∫°y</button>
        <button class="secondary-btn" onclick="generateLink()">üîó T·∫°o Link G·ª≠i T·∫∑ng</button>
        <div id="share-info" style="font-size: 11px; color: #0f0; display: none;">ƒê√£ copy link!</div>
    </div>

    <script>
        /* --- CONFIGURATION & STATE --- */
        const CONFIG = {
            particleCount: 1200, // Gi·∫£m nh·∫π s·ªë h·∫°t ƒë·ªÉ m∆∞·ª£t h∆°n
            messages: [],
            signature: "",
            images: [],
            musicUrl: ""
        };

        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let messageInterval;
        let currentMessageIndex = 0;
        
        // Resize Handler
        function onResize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        window.addEventListener('resize', onResize);
        onResize();

        /* --- HEART MATH --- */
        function getHeartPoint(t) {
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
            return { x, y };
        }

        /* --- PARTICLE SYSTEM --- */
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width; this.y = Math.random() * height;
                let t = Math.random() * Math.PI * 2; 
                let heartPos = getHeartPoint(t);
                // Scale dynamic theo m√†n h√¨nh
                const scale = Math.min(width, height) / 45; 
                this.targetX = width / 2 + heartPos.x * scale; 
                this.targetY = height / 2 + heartPos.y * scale - 30; // D·ªãch l√™n t√≠ ƒë·ªÉ nh∆∞·ªùng ch·ªó cho ch·ªØ
                this.velocity = Math.random() * 0.04 + 0.01; 
                this.size = Math.random() * 2; 
                this.opacity = 0;
            }
            update() {
                this.x += (this.targetX - this.x) * this.velocity; 
                this.y += (this.targetY - this.y) * this.velocity;
                if (Math.abs(this.targetX - this.x) < 5) this.opacity = Math.random() * 0.8 + 0.2; // L·∫•p l√°nh
                else this.opacity = Math.min(this.opacity + 0.005, 1);
            }
            draw() { 
                ctx.beginPath(); 
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); 
                ctx.fillStyle = `rgba(255, 105, 180, ${this.opacity})`; 
                ctx.fill(); 
            }
        }

        function initParticles() { particles = []; for (let i = 0; i < CONFIG.particleCount; i++) particles.push(new Particle()); }

        /* --- TEXT TYPEWRITER EFFECT --- */
        let typeWriterText = "";
        let typeWriterIndex = 0;
        let isDeleting = false;
        let typeSpeed = 100;

        function updateTextLogic() {
            const currentFullText = CONFIG.messages[currentMessageIndex];
            
            if (isDeleting) {
                typeWriterText = currentFullText.substring(0, typeWriterText.length - 1);
                typeSpeed = 50;
            } else {
                typeWriterText = currentFullText.substring(0, typeWriterText.length + 1);
                typeSpeed = 150;
            }

            if (!isDeleting && typeWriterText === currentFullText) {
                // ƒê√£ g√µ xong c√¢u, ƒë·ª£i 2s r·ªìi x√≥a
                isDeleting = true;
                typeSpeed = 2000; 
            } else if (isDeleting && typeWriterText === "") {
                // ƒê√£ x√≥a xong, chuy·ªÉn c√¢u ti·∫øp theo
                isDeleting = false;
                currentMessageIndex = (currentMessageIndex + 1) % CONFIG.messages.length;
                typeSpeed = 500;
            }
        }

        // Loop g√µ ch·ªØ ƒë·ªôc l·∫≠p v·ªõi render
        function typeWriterLoop() {
            if(CONFIG.messages.length > 0) updateTextLogic();
            setTimeout(typeWriterLoop, typeSpeed);
        }

        function drawText() {
            ctx.fillStyle = "white"; 
            ctx.font = "bold 30px 'Segoe UI', Arial"; 
            ctx.textAlign = "center";
            ctx.shadowColor = "#ff69b4"; ctx.shadowBlur = 15;
            
            // V·∫Ω ch·ªØ typewriter
            ctx.fillText(typeWriterText + "|", width / 2, height / 2 + 50); // D·∫•u | nh·∫•p nh√°y
            
            ctx.shadowBlur = 0;
        }

        function animate() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.15)"; // X√≥a m·ªù ƒë·ªÉ t·∫°o ƒëu√¥i
            ctx.fillRect(0, 0, width, height);
            
            particles.forEach(p => { p.update(); p.draw(); });
            drawText();
            requestAnimationFrame(animate);
        }

        /* --- FLOATING IMAGES --- */
        let imgInterval;
        function startFloatingImages() {
            const container = document.getElementById('image-container'); container.innerHTML = '';
            if (imgInterval) clearInterval(imgInterval);
            if (CONFIG.images.length === 0) return;

            imgInterval = setInterval(() => {
                const imgUrl = CONFIG.images[Math.floor(Math.random() * CONFIG.images.length)];
                if (!imgUrl) return;
                const img = document.createElement('img'); 
                img.src = imgUrl.trim(); 
                img.className = 'floating-image';
                img.style.left = Math.random() * 90 + '%'; 
                img.style.animationDuration = (Math.random() * 10 + 10) + 's'; // 10-20s
                container.appendChild(img);
                setTimeout(() => img.remove(), 20000);
            }, 1500); // 1.5s ra 1 ·∫£nh
        }

        /* --- CONTROL LOGIC --- */
        function toggleUI() { document.getElementById('ui-layer').classList.toggle('hidden'); }

        function startEffect(fromUrl = false) {
            // L·∫•y d·ªØ li·ªáu
            if(!fromUrl) {
                const rawMsg = document.getElementById('MessagesInput').value;
                CONFIG.messages = rawMsg.split('\n').filter(t => t.trim() !== "");
                CONFIG.signature = document.getElementById('SignatureInput').value;
                CONFIG.musicUrl = document.getElementById('MusicInput').value;
                const rawImgs = document.getElementById('ImagesInput').value;
                CONFIG.images = rawImgs.split(',').filter(t => t.trim() !== "");
            }

            // X·ª≠ l√Ω UI
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('signature').innerText = CONFIG.signature ? "üíå G·ª≠i t·ª´: " + CONFIG.signature : "";
            
            // X·ª≠ l√Ω Nh·∫°c
            const audio = document.getElementById('bg-music');
            if (CONFIG.musicUrl && CONFIG.musicUrl !== audio.src) {
                audio.src = CONFIG.musicUrl;
                audio.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            } else if (audio.src) {
                audio.play();
            }

            // Reset tr·∫°ng th√°i
            currentMessageIndex = 0;
            typeWriterText = "";
            isDeleting = false;
            
            initParticles();
            startFloatingImages();
        }

        function generateLink() {
            const msg = encodeURIComponent(document.getElementById('MessagesInput').value);
            const sig = encodeURIComponent(document.getElementById('SignatureInput').value);
            const mus = encodeURIComponent(document.getElementById('MusicInput').value);
            const imgs = encodeURIComponent(document.getElementById('ImagesInput').value);
            
            const url = `${window.location.origin}${window.location.pathname}?msg=${msg}&sig=${sig}&mus=${mus}&imgs=${imgs}`;
            
            navigator.clipboard.writeText(url).then(() => {
                const info = document.getElementById('share-info');
                info.style.display = 'block';
                setTimeout(() => info.style.display = 'none', 3000);
            });
        }

        /* --- AUTO RUN FROM URL --- */
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('msg')) {
                CONFIG.messages = decodeURIComponent(params.get('msg')).split('\n');
                if(params.has('sig')) CONFIG.signature = decodeURIComponent(params.get('sig'));
                if(params.has('mus')) CONFIG.musicUrl = decodeURIComponent(params.get('mus'));
                if(params.has('imgs')) CONFIG.images = decodeURIComponent(params.get('imgs')).split(',');
                
                // ƒêi·ªÅn l·∫°i v√†o form ƒë·ªÉ ng∆∞·ªùi xem c√≥ th·ªÉ ch·ªânh s·ª≠a n·∫øu mu·ªën
                document.getElementById('MessagesInput').value = CONFIG.messages.join('\n');
                document.getElementById('SignatureInput').value = CONFIG.signature;
                document.getElementById('MusicInput').value = CONFIG.musicUrl;
                document.getElementById('ImagesInput').value = CONFIG.images.join(',');

                startEffect(true);
            } else {
                initParticles(); // Ch·∫°y n·ªÅn ch·ªù
            }
            animate();
            typeWriterLoop();
        };
    </script>
</body>
</html>
